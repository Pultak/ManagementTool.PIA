-- DROP SCHEMA "manTool";

CREATE SCHEMA "manTool" AUTHORIZATION postgres;

-- DROP TYPE "manTool".assignmentstate;

CREATE TYPE "manTool".assignmentstate AS ENUM (
	'Active',
	'Draft',
	'Cancelled',
	'Done');

-- DROP TYPE "manTool".roletype;

CREATE TYPE "manTool".roletype AS ENUM (
	'Superior',
	'DepartmentManager',
	'Secretariat',
	'ProjectManager');

-- DROP SEQUENCE "manTool"."Assignment_id_assignment_seq";

CREATE SEQUENCE "manTool"."Assignment_id_assignment_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 1
	CACHE 1
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."Assignment_id_assignment_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."Assignment_id_assignment_seq" TO postgres;

-- DROP SEQUENCE "manTool"."Project_id_project_seq";

CREATE SEQUENCE "manTool"."Project_id_project_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 1
	CACHE 1
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."Project_id_project_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."Project_id_project_seq" TO postgres;

-- DROP SEQUENCE "manTool"."Role_id_role_seq";

CREATE SEQUENCE "manTool"."Role_id_role_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 10
	CACHE 10
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."Role_id_role_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."Role_id_role_seq" TO postgres;

-- DROP SEQUENCE "manTool"."UserProjectXRefs_id_seq";

CREATE SEQUENCE "manTool"."UserProjectXRefs_id_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 1
	CACHE 1
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."UserProjectXRefs_id_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."UserProjectXRefs_id_seq" TO postgres;

-- DROP SEQUENCE "manTool"."UserRoleXRefs_id_seq";

CREATE SEQUENCE "manTool"."UserRoleXRefs_id_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 10
	CACHE 10
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."UserRoleXRefs_id_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."UserRoleXRefs_id_seq" TO postgres;

-- DROP SEQUENCE "manTool"."UserSuperiorXRefs_id_seq";

CREATE SEQUENCE "manTool"."UserSuperiorXRefs_id_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."UserSuperiorXRefs_id_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."UserSuperiorXRefs_id_seq" TO postgres;

-- DROP SEQUENCE "manTool"."User_id_user_seq";

CREATE SEQUENCE "manTool"."User_id_user_seq"
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 10
	CACHE 10
	CYCLE;

-- Permissions

ALTER SEQUENCE "manTool"."User_id_user_seq" OWNER TO postgres;
GRANT ALL ON SEQUENCE "manTool"."User_id_user_seq" TO postgres;
-- "manTool"."Assignment" definition

-- Drop table

-- DROP TABLE "manTool"."Assignment";

CREATE TABLE "manTool"."Assignment" (
	id_assignment int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	id_project int8 NULL,
	id_user int8 NULL,
	allocation_scope int8 NULL,
	from_date date NULL,
	to_date date NULL,
	state text NULL,
	"name" text NULL,
	note text NULL,
	CONSTRAINT "Assignment_pkey" PRIMARY KEY (id_assignment)
);

-- Permissions

ALTER TABLE "manTool"."Assignment" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."Assignment" TO postgres;


-- "manTool"."Project" definition

-- Drop table

-- DROP TABLE "manTool"."Project";

CREATE TABLE "manTool"."Project" (
	id_project int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	project_name text NULL,
	from_date date NULL,
	to_date date NULL,
	description text NULL,
	CONSTRAINT "Project_pkey" PRIMARY KEY (id_project)
);

-- Permissions

ALTER TABLE "manTool"."Project" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."Project" TO postgres;


-- "manTool"."Role" definition

-- Drop table

-- DROP TABLE "manTool"."Role";

CREATE TABLE "manTool"."Role" (
	id_role int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"name" text NULL,
	"type" text NULL,
	id_project int8 NULL,
	CONSTRAINT "Role_pkey" PRIMARY KEY (id_role)
);

-- Permissions

ALTER TABLE "manTool"."Role" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."Role" TO postgres;


-- "manTool"."User" definition

-- Drop table

-- DROP TABLE "manTool"."User";

CREATE TABLE "manTool"."User" (
	id_user int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	pwd text NULL,
	full_name text NULL,
	username text NULL,
	primary_workplace text NULL,
	email_address text NULL,
	pwd_changed bool NULL,
	salt text NULL,
	CONSTRAINT "User_pkey" PRIMARY KEY (id_user)
);

-- Permissions

ALTER TABLE "manTool"."User" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."User" TO postgres;


-- "manTool"."UserProjectXRefs" definition

-- Drop table

-- DROP TABLE "manTool"."UserProjectXRefs";

CREATE TABLE "manTool"."UserProjectXRefs" (
	id_project int8 NULL,
	assigned_date date NULL,
	id_user int8 NULL,
	id int8 NOT NULL GENERATED ALWAYS AS IDENTITY,
	CONSTRAINT "UserProjectXRefs_pkey" PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE "manTool"."UserProjectXRefs" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."UserProjectXRefs" TO postgres;


-- "manTool"."UserRoleXRefs" definition

-- Drop table

-- DROP TABLE "manTool"."UserRoleXRefs";

CREATE TABLE "manTool"."UserRoleXRefs" (
	id_user int8 NULL,
	id_role int8 NULL,
	assigned_date date NULL,
	id int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	CONSTRAINT "UserRoleXRefs_pkey" PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE "manTool"."UserRoleXRefs" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."UserRoleXRefs" TO postgres;


-- "manTool"."UserSuperiorXRefs" definition

-- Drop table

-- DROP TABLE "manTool"."UserSuperiorXRefs";

CREATE TABLE "manTool"."UserSuperiorXRefs" (
	id serial4 NOT NULL,
	id_user int8 NOT NULL,
	id_superior_user int8 NOT NULL,
	assigned_date date NOT NULL,
	CONSTRAINT "UserSuperiorXRefs_pkey" PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE "manTool"."UserSuperiorXRefs" OWNER TO postgres;
GRANT ALL ON TABLE "manTool"."UserSuperiorXRefs" TO postgres;




-- Permissions

GRANT ALL ON SCHEMA "manTool" TO postgres;

INSERT INTO "manTool"."Role" (id_role,"name","type",id_project) VALUES
	 (100000,'Sekretariat','Secretariat',NULL),
	 (200000,'Manažer oddělení','DepartmentManager',NULL),
	 (300000,'Vedoucí','Superior',NULL);
INSERT INTO "manTool"."User" (id_user,pwd,full_name,username,primary_workplace,email_address,pwd_changed,salt) VALUES
	 (100000,'G1Ii0Y26NGzjiC1eoMVpuCuPW1xTTlf65c0jq9SJkf0=','Admin','admin','KIV','admin@kiv.cz',false,'MdAWirg+6/S4U1HDgPBLnQ=='),
	 (200000,'G1Ii0Y26NGzjiC1eoMVpuCuPW1xTTlf65c0jq9SJkf0=','Josef Novák','depMan1','KIV','novas@kiv.cz',false,'MdAWirg+6/S4U1HDgPBLnQ=='),
	 (300000,'G1Ii0Y26NGzjiC1eoMVpuCuPW1xTTlf65c0jq9SJkf0=','David Němý','sup1','KIV','nemejc@kiv.cz',false,'MdAWirg+6/S4U1HDgPBLnQ=='),
	 (400000,'G1Ii0Y26NGzjiC1eoMVpuCuPW1xTTlf65c0jq9SJkf0=','Ondřej Havlíček','sup2','KIV','havlicek@kiv.cz',false,'MdAWirg+6/S4U1HDgPBLnQ=='),
	 (500000,'G1Ii0Y26NGzjiC1eoMVpuCuPW1xTTlf65c0jq9SJkf0=','Andrea Nováková','secrt','KIV','novakova@kiv.cz',false,'MdAWirg+6/S4U1HDgPBLnQ==');
INSERT INTO "manTool"."UserRoleXRefs" (id_user,id_role,assigned_date,id) VALUES
	 (100000,200000,'2023-01-19',10000),
	 (100000,300000,'2023-01-19',200000),
	 (100000,100000,'2023-01-19',300000),
	 (200000,200000,'2023-01-19',400000),
	 (300000,300000,'2023-01-19',500000),
	 (400000,300000,'2023-01-19',600000),
	 (500000,100000,'2023-01-19',700000);
